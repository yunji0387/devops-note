# Running Behave for Behavior Driven Development

# Table of Contents
1. [Generating Steps with Behave](#generating_steps_with_behave)
2. [Imlpementing Your First Steps](#implementing_your_first_step)
3. [Working with Context](#working_with_context)
4. [Using Variable Substitution](#using_variable_substitution)

---

<a id="generating_steps_with_behave"></a>
# Generating Steps with Behave
<details close>
<summary><b>(click to expand/hide)</b></summary>
<!-- MarkdownTOC -->

# Using Behave to Generate Python Steps

Behave is a powerful tool that can help generate steps for your BDD tests. It can create initial steps or identify missing ones during the development of your feature scenarios.

## Generating Steps with Behave

When you run Behave against a feature file, it processes the file and outputs any missing steps. The output will include:

- The filename and line number of the feature.
- The line number of each scenario within the feature file.
- A color-coded status for each step:
  - **Yellow** for undefined steps.
  - **Blue** for skipped steps, which Behave skips after encountering an undefined step.

After running the scenarios, Behave provides a summary of the results, including the count of passed, failed, skipped, or undefined steps. If you haven't written any steps, all the steps will be reported as undefined.

## Behave's Output and Snippets

Behave not only identifies missing steps but also suggests code snippets that you can use to start building your steps file. The output includes:

- A clear indication of the type of step (Given, When, or Then) through appropriate decorators.
- The text to match each step as a string.
- A placeholder implementation that raises a `NotImplementedError`, which you'll need to replace with actual step code.

This functionality serves as a starting point for developing your steps file and ensures coverage for all your scenarios.

## Example Output

When you run Behave with an incomplete steps file, you might see something like this:

```plaintext
Feature: Search for dogs - pets.feature:1
  Scenario: search for dogs - pets.feature:7
    When I visit the "Home Page" - None
    Then I should see "Welcome to the Pet Shop" - None
    ...

1 feature passed, 0 failed, 0 skipped
1 scenario passed, 0 failed, 0 skipped
5 steps passed, 0 failed, 0 skipped, 5 undefined
```
You can implement step definitions for undefined steps with these snippets:
```python
@given('...')
def step_impl(context):
    raise NotImplementedError('STEP: Given ...')

@when('...')
def step_impl(context):
    raise NotImplementedError('STEP: When ...')

@then('...')
def step_impl(context):
    raise NotImplementedError('STEP: Then ...')
```
Copy and paste these snippets into your steps file to begin fleshing out the step implementations.

## Summary
- Behave's step generation feature simplifies the process of starting BDD test development.
- It provides a structured way to ensure all scenarios are accounted for with corresponding steps.
- The snippets offered by Behave form the skeleton of your steps file, which you will then develop with actual test code.

<!-- /MarkdownTOC -->
</details>

---

<a id="implementing_your_first_step"></a>
# Imlpementing Your First Steps
<details close>
<summary><b>(click to expand/hide)</b></summary>
<!-- MarkdownTOC -->

# Implementing Python Steps with Behave

The workflow for implementing generated Python steps in Behave involves the following steps:

## Step-by-Step Workflow

1. **Create a Steps File:** Start with the recommended steps generated by Behave and copy them to your clipboard.

2. **Paste into Steps File:** Create a `web_steps.py` file in the steps folder and paste the copied Python functions into this file. Import the necessary decorators from Behave, such as `@given`, `@when`, and `@then`.

3. **Run Behave:** Execute Behave to check the output. Initially, steps will fail because they contain placeholder code that raises `NotImplementedError`.

4. **Observe Output:**
   - Failing steps will be marked red.
   - Behave identifies the file and line number where it found the steps.
   - The error message will indicate `NotImplementedError`.
   - Subsequent steps in the scenario are skipped (marked blue).

5. **Implement First Step:**
   - Remove the line raising the `NotImplementedError` exception.
   - Add the actual implementation, such as navigating to the home page using `context.driver.get(context.base_url)`.

6. **Verify Step Passes:** Run Behave again to ensure the first step turns green, indicating it has passed.

7. **Implement Remaining Steps:** Repeat the process of implementing each failing step, running Behave, and verifying it passes until all steps are green.

## Example of Generated Steps Output

```plaintext
Feature: The pet store catalog service - pets.feature:1
Scenario: The website is up - pets.feature:7
When I visit the "Home Page" - features/steps/web_steps.py:3
...
```
## Example of Steps Implementation
```python
from behave import given, when, then

@given('I am on the "Home page"')
def step_impl(context):
    context.driver.get(context.base_url)

# Add more implementations for the remaining steps
```

## Key Takeaways
- The generated steps are just starting points and must be replaced with actual test code.
- The `context` object provides access to shared data and configurations set in `environment.py`.
- Behave runs one scenario at a time and skips the remaining steps in a scenario if a step fails.
- Continue to implement and run Behave iteratively until all steps are successfully passing.

This process is straightforward and iterative, ensuring that all steps are accurately implemented and functional.

<!-- /MarkdownTOC -->
</details>

---

<a id="working_with_context"></a>
# Working with Context
<details close>
<summary><b>(click to expand/hide)</b></summary>
<!-- MarkdownTOC -->

# Using the Context Variable in Behave

The `context` variable is a powerful feature in Behave that allows for the sharing of information between steps. It acts as a shared container accessible to all steps throughout the execution of a feature file.

## Overview of Context

- The `context` variable is passed into every Python step definition.
- Serves as a persistent storage mechanism across steps within a feature file.
- Useful for passing data and ensuring state consistency from one step to another.

## Examples of Using Context

### Example 1: Flask Test Client
```python
@given('the server is started')
def step_impl(context):
    context.client = app.test_client()

@when('I retrieve the root URL')
def step_impl(context):
    context.response = context.client.get('/')

@then('I should see "{message}" in the response')
def step_impl(context, message):
    assert message in context.response.data
```
- **Usage**: Stores the Flask test client and response objects in `context` for use in subsequent steps.

## Example 2: Simulated Clipboard
```python
@given('I copy the "{element_name}" field')
def step_impl(context, element_name):
    element_id = f"{element_name}_id"
    element = context.driver.find_element_by_id(element_id)
    context.clipboard = element.get_attribute('value')

@when('I paste the "{element_name}" field')
def step_impl(context, element_name):
    element_id = f"{element_name}_id"
    element = context.driver.find_element_by_id(element_id)
    element.clear()
    element.send_keys(context.clipboard)
```
- **Usage**: Implements a simulated clipboard to store and retrieve values for copy-and-paste actions.

## Key Takeaways
- **Flexibility**: The context variable allows for flexible and dynamic step implementations.
- **Consistency**: Ensures consistency in test data and state across different steps.
- **Accessibility**: All steps within a feature file can access and manipulate data stored in the context.
- **Best Practices**: It is recommended to use meaningful names for context attributes to maintain code readability and intent.

By leveraging the context variable, you can create more complex and stateful tests that mimic real-world user interactions and data flows.

<!-- /MarkdownTOC -->
</details>

---

<a id="using_variable_substitution"></a>
# Using Variable Substitution
<details close>
<summary><b>(click to expand/hide)</b></summary>
<!-- MarkdownTOC -->

<!-- /MarkdownTOC -->
</details>

---
